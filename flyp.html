<!DOCTYPE html>

<html>

<head>

	<title> Flyp: The Flip-Flop Game </title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

</head>

<body>
	<center>

		<canvas id="gameGrid" width="400" height="360" style="border:16px solid #d3e3e3;>
			You browser does not support the HTML5 canvas tag.
		</canvas>
		
		<p>
			<button onclick="flip();">
				Flip
			</button>
			<button onclick="flop();">
				Flop
			</button>
		</p>
    
	</center>

	<hr></hr>
  
	<p id="score">Score: 0</p>
	<p id="length">Length: 1</p>
	<p id="speed">Speed: 1</p>

	<script>
  
		document.documentElement.style.overflow = 'hidden';  // firefox, chrome
		document.body.scroll = "no"; // ie only
		
		var c 	= document.getElementById('gameGrid');
		var ctx = c.getContext('2d');
		
		// flipper => [x,y,length,angle];
		var flipper 	= [c.width/2, c.height/2, 20, 0];
		var dTheta 	= Math.PI/64;
		var score 	= 0;
		var length	= 1;
		var speed 	= 1;
	
		var pts_size 	= 2;
		var pts 	= [ Math.floor(Math.random() * (c.width - 2 * pts_size) + pts_size),
					Math.floor(Math.random() * (c.height - 2 * pts_size) + pts_size) ];
				
		
		setInterval(update, 15);
		
		window.addEventListener('keypress', keyHandler);
		c.addEventListener('tap', flop());
		c.addEventListener('dbltap', flip());

		
		function update()
		{
		//https://careers.vmware.com/job/palo-alto/intern-mts-launch-undergrad-intern-program/1567/4445343
		
			ctx.clearRect(0, 0, c.width, c.height);
			
			ctx.beginPath();
			ctx.arc(pts[0], pts[1], pts_size, 0, 2 * Math.PI);
			ctx.stroke();
			ctx.beginPath();
			ctx.moveTo(flipper[0],flipper[1]);
			ctx.lineTo(flipper[0] + flipper[2] * Math.cos(flipper[3]), 
					flipper[1] + flipper[2] * Math.sin(flipper[3]));
			ctx.stroke();
			
			flipper[3] += dTheta;
			flipper[3] %= 2*Math.PI;
			
			checkCollision();
			
			if(ctx.isPointInPath(pts[0], pts[1]))
			{
				alert("COLLIDED");
			}			
		}

		function checkCollision()
		{
			x2 = flipper[0] + flipper[2] * Math.cos(flipper[3]); 
			y2 = flipper[1] + flipper[2] * Math.sin(flipper[3]);
			
			//Check Collision with Walls
			if ( x2 <= 0 || x2 >= c.width-1 || y2 <= 0 || y2 >= c.height -1)
			{
				alert("Game Over");
				flipper = [c.width/2, c.height/2, 20, 0];
				score = 0;
				length = 1;
				speed = 1;
						
				// Update HTML
				document.getElementById("score").innerHTML = "Score: " + score;		
				document.getElementById("length").innerHTML = "Length: " + length;		
				document.getElementById("speed").innerHTML = "Speed: " + speed;		
			}
			
			// Check Collision with PTS
			if ( pts[0] <= Math.max(flipper[0], x2) && pts[0] >= Math.min(flipper[0],x2) &&
				pts[1] <= Math.max(flipper[1], y2) && pts[1] >= Math.min(flipper[1],y2))
			{
				// Update Variables
				score += 10;
				
				flipper[2] += (-1 + 2*(flipper[2] > 0)) * (Math.pow(2,1 + Math.floor(1+Math.log10(Math.abs(flipper[2]))/4)));
				
				dTheta *=0.95;
				
				pts = [ Math.floor(Math.random() * (c.width - 2 * pts_size) + pts_size),
					Math.floor(Math.random() * (c.height - 2 * pts_size) + pts_size) ];
				
				// Update HTML
				document.getElementById("score").innerHTML = "Score: " + score;		
				document.getElementById("length").innerHTML = "Length: " + length;		
				document.getElementById("speed").innerHTML = "Speed: " + speed;		
			}
			
			
		}
		
		function keyHandler(e)
		{
			var keyCode = e.keyCode;
			if(keyCode == 32)
			{
				if(e.shiftKey)
				{
					flop();
				}
				else
				{
					flip();
				}
			}
			else if(keyCode == 113)
			{
				if(Math.abs( dTheta) < Math.abs(  Math.PI*flipper[2]/(20*48)) && Math.abs(flipper[2]) > 16)
				{
					flipper[2] -= (-1 + 2*(flipper[2] > 0 )) * (Math.pow(2,1+Math.floor(1+Math.log10(Math.abs(flipper[2]))/4)));
					dTheta = (-1 + 2*(dTheta > 0)) * Math.min(Math.abs(dTheta*1.19), Math.abs(Math.PI*flipper[2]/(20*32)));
				}
			}
		}
		
		function flip()
		{
			dTheta *= -1;
		}
		function flop()
		{
			flipper[0] += flipper[2] * Math.cos(flipper[3]);
			flipper[1] += flipper[2] * Math.sin(flipper[3]);
			
			flipper[2] *= -1;
			
		}
		
	</script>

</body>


</html>
